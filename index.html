<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Finance | Dashboard Inteligente</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --primary-light: #3391FF;
            --secondary: #FF6B35;
            --accent: #00D4AA;
            --danger: #FF4757;
            --warning: #FFA502;
            --success: #00D4AA;
            --dark: #1A1D29;
            --darker: #151822;
            --light: #F8FAFC;
            --gray: #64748B;
            --gray-dark: #334155;
            --card-bg: rgba(255, 255, 255, 0.05);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #2D1B69 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Tela de Login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 2.2rem;
        }

        .login-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray);
        }

        .login-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .login-form {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .login-form.active {
            display: block;
        }

        /* Header Moderno */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo i {
            font-size: 2rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-email {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .logout-btn {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Navegação Principal */
        .main-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .main-tab {
            flex: 1;
            padding: 15px 25px;
            text-align: center;
            cursor: pointer;
            border-radius: 15px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray);
            position: relative;
            overflow: hidden;
        }

        .main-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 8px 25px rgba(0, 102, 255, 0.3);
        }

        .main-tab i {
            margin-right: 8px;
        }

        /* Navegação por Mês */
        .month-navigation {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .month-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 5px 0;
        }

        .month-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .month-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary-light);
        }

        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        /* Conteúdo das Abas */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid Principal */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Cards de Destaque */
        .highlight-cards {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .card.essential {
            border-left: 4px solid var(--primary);
        }

        .card.non-essential {
            border-left: 4px solid var(--secondary);
        }

        .card.revenue {
            border-left: 4px solid var(--success);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-amount {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-progress {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }

        .card-progress-bar {
            height: 100%;
            border-radius: 3px;
        }

        .essential .card-progress-bar { background: var(--primary); }
        .non-essential .card-progress-bar { background: var(--secondary); }
        .revenue .card-progress-bar { background: var(--success); }

        /* Listas Detalhadas de Gastos */
        .expenses-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .expense-category {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .expense-category.essential {
            border-left: 4px solid var(--primary);
        }

        .expense-category.non-essential {
            border-left: 4px solid var(--secondary);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--glass-border);
        }

        .category-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .category-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-item-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-item-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* Formulários CORRIGIDOS */
        .add-expense-form, .add-revenue-form {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
        }

        .form-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 12px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 0.8rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px 15px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 48px; /* Altura mínima para melhor visualização */
        }

        /* CORREÇÃO: Estilo específico para o select de categoria */
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748B'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.2);
        }

        .form-input::placeholder {
            color: var(--gray);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            min-width: 80px;
            min-height: 48px; /* Mesma altura dos inputs */
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #00b894);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff3838);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            background: var(--glass);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            width: 90%;
            max-width: 500px;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .modal-close:hover {
            color: var(--light);
        }

        /* Gráficos - NOVA ABA DE RELATÓRIOS */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Metas Financeiras - COM CONQUISTAS COLORIDAS */
        .goals-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
        }

        /* Cards de Conquistas */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .achievement-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.2);
        }

        .achievement-card.success {
            border-left-color: var(--success);
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
        }

        .achievement-card.success .achievement-icon {
            background: linear-gradient(135deg, var(--success), #00b894);
        }

        .achievement-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .achievement-card.success .achievement-value {
            background: linear-gradient(135deg, var(--success), #00b894);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .achievement-label {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .achievement-description {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 8px;
        }

        .goals-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .goal-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            position: relative;
            border-left: 4px solid var(--primary);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .goal-title {
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--light);
        }

        .goal-amount {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--success);
            text-align: right;
        }

        .goal-progress-container {
            margin: 20px 0;
        }

        .goal-progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .goal-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .goal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .goal-detail-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .goal-detail-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .goal-detail-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--light);
        }

        .goal-detail-value.remaining {
            color: var(--primary);
        }

        .goal-detail-value.monthly {
            color: var(--success);
        }

        .goal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Insights com IA */
        .ai-insight {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
            position: relative;
        }

        .ai-insight::before {
            content: '🤖';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            opacity: 0.3;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Notificações */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .notification {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            backdrop-filter: blur(20px);
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification.info {
            border-left: 4px solid var(--primary);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
        }

        .notification.success .notification-icon {
            background: var(--success);
        }

        .notification.error .notification-icon {
            background: var(--danger);
        }

        .notification.warning .notification-icon {
            background: var(--warning);
        }

        .notification.info .notification-icon {
            background: var(--primary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            margin-left: auto;
        }

        .notification-close:hover {
            color: var(--light);
        }

        /* Animações Adicionais */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* CORREÇÃO: Layout responsivo para formulários */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .highlight-cards {
                grid-template-columns: 1fr;
            }
            
            .expenses-detail {
                grid-template-columns: 1fr;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .goal-details {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .main-tabs, .month-tabs {
                flex-direction: column;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr;
            }
            
            .goal-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .goal-amount {
                text-align: left;
            }

            .user-menu {
                flex-direction: column;
                gap: 10px;
            }

            .user-info {
                flex-direction: column;
                text-align: center;
            }

            .user-details {
                text-align: center;
            }

            /* CORREÇÃO: Ajuste específico para formulários em mobile */
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-select, .form-input {
                font-size: 16px; /* Previne zoom no iOS */
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .notification {
                min-width: 280px;
                right: 10px;
            }
            
            .add-expense-form, .add-revenue-form {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-brain-circuit"></i>
                <span>NexusFinance</span>
            </div>
            
            <div class="login-tabs">
                <div class="login-tab active" onclick="switchLoginTab('login')">Entrar</div>
                <div class="login-tab" onclick="switchLoginTab('register')">Cadastrar</div>
            </div>

            <!-- Formulário de Login -->
            <div id="loginForm" class="login-form active">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="seu@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Sua senha">
                </div>
                <button class="btn" onclick="login()" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </div>

            <!-- Formulário de Cadastro -->
            <div id="registerForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="registerName" placeholder="Seu nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="seu@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="Mínimo 6 caracteres">
                </div>
                <div class="form-group">
                    <label class="form-label">Confirmar Senha</label>
                    <input type="password" class="form-input" id="registerConfirmPassword" placeholder="Digite novamente">
                </div>
                <button class="btn btn-success" onclick="register()" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-user-plus"></i> Criar Conta
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard (após login) -->
    <div id="dashboardScreen" class="container" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-brain-circuit"></i>
                <span>NexusFinance</span>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">
                        <!-- Inicial será preenchida via JS -->
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Usuário</div>
                        <div class="user-email" id="userEmail">usuario@email.com</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>

        <!-- Navegação Principal - COM NOVA ABA -->
        <div class="main-tabs">
            <div class="main-tab active" onclick="switchMainTab('dashboard')">
                <i class="fas fa-chart-network"></i> Dashboard
            </div>
            <div class="main-tab" onclick="switchMainTab('reports')">
                <i class="fas fa-chart-bar"></i> Relatórios
            </div>
            <div class="main-tab" onclick="switchMainTab('goals')">
                <i class="fas fa-bullseye"></i> Metas
            </div>
            <div class="main-tab" onclick="switchMainTab('insights')">
                <i class="fas fa-robot"></i> Insights IA
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <!-- Navegação por Mês -->
            <div class="month-navigation">
                <div class="month-header">
                    <h3>Selecione o Mês</h3>
                    <span id="currentMonthDisplay">Janeiro 2024</span>
                </div>
                <div class="month-tabs" id="monthTabs">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>

            <div class="dashboard-grid">
                <div>
                    <!-- Cards de Destaque -->
                    <div class="highlight-cards">
                        <div class="card essential">
                            <div class="card-title">
                                <i class="fas fa-home"></i>
                                <span>GASTOS ESSENCIAIS</span>
                            </div>
                            <div class="card-amount" id="essentialAmount">R$ 0,00</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" id="essentialProgress" style="width: 0%"></div>
                            </div>
                            <div class="card-meta" id="essentialMeta">0% da receita</div>
                        </div>

                        <div class="card non-essential">
                            <div class="card-title">
                                <i class="fas fa-gamepad"></i>
                                <span>GASTOS NÃO ESSENCIAIS</span>
                            </div>
                            <div class="card-amount" id="nonEssentialAmount">R$ 0,00</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" id="nonEssentialProgress" style="width: 0%"></div>
                            </div>
                            <div class="card-meta" id="nonEssentialMeta">0% da receita</div>
                        </div>

                        <div class="card revenue">
                            <div class="card-title">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>RECEITA TOTAL</span>
                            </div>
                            <div class="card-amount" id="revenueAmount">R$ 0,00</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" id="revenueProgress" style="width: 0%"></div>
                            </div>
                            <div class="card-meta" id="revenueMeta">0% utilizado</div>
                        </div>
                    </div>

                    <!-- Listas Detalhadas de Gastos -->
                    <div class="expenses-detail">
                        <div class="expense-category essential">
                            <div class="category-header">
                                <i class="fas fa-home" style="color: var(--primary);"></i>
                                <h3>Gastos Essenciais</h3>
                            </div>
                            <div class="category-list" id="essentialList">
                                <!-- Preenchido via JavaScript -->
                            </div>
                        </div>

                        <div class="expense-category non-essential">
                            <div class="category-header">
                                <i class="fas fa-gamepad" style="color: var(--secondary);"></i>
                                <h3>Gastos Não Essenciais</h3>
                            </div>
                            <div class="category-list" id="nonEssentialList">
                                <!-- Preenchido via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar - Adicionar Gastos e Receita -->
                <div>
                    <!-- Adicionar Receita -->
                    <div class="add-revenue-form">
                        <div class="form-title">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Adicionar Receita</span>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Descrição</label>
                                <input type="text" class="form-input" id="revenueName" placeholder="Salário, Freela, Investimentos...">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Valor (R$)</label>
                                    <input type="number" class="form-input" id="revenueValue" placeholder="0,00" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="opacity: 0;">Ação</label>
                                    <button class="btn btn-success" onclick="addRevenue()">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Adicionar Gastos - CORRIGIDO -->
                    <div class="add-expense-form">
                        <div class="form-title">
                            <i class="fas fa-plus-circle"></i>
                            <span>Adicionar Gasto</span>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Descrição</label>
                                <input type="text" class="form-input" id="expenseName" placeholder="Aluguel, Mercado, Lazer...">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Valor (R$)</label>
                                    <input type="number" class="form-input" id="expenseValue" placeholder="0,00" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Categoria</label>
                                    <select class="form-select" id="expenseCategory">
                                        <option value="essential">Essencial</option>
                                        <option value="non-essential">Não Essencial</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="opacity: 0;">Ação</label>
                                    <button class="btn" onclick="addExpense()">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOVA ABA: Relatórios -->
        <div id="reports" class="tab-content">
            <div class="month-navigation">
                <div class="month-header">
                    <h3>Relatórios Financeiros</h3>
                    <span>Análise Detalhada</span>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Distribuição de Gastos</h3>
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <canvas id="expenseChart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Evolução de Renda</h3>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <canvas id="incomeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Aba de Metas - COM CONQUISTAS COLORIDAS -->
        <div id="goals" class="tab-content">
            <div class="goals-container">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 class="section-title">Metas Financeiras</h2>
                    <button class="btn" onclick="showAddGoalModal()">
                        <i class="fas fa-bullseye"></i> Nova Meta
                    </button>
                </div>

                <!-- Cards de Conquistas -->
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Preenchido via JavaScript -->
                </div>
                
                <div class="goals-grid" id="goalsList">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Modal para Adicionar Meta -->
        <div id="addGoalModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nova Meta Financeira</h3>
                    <button class="modal-close" onclick="closeAddGoalModal()">&times;</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome da Meta</label>
                        <input type="text" class="form-input" id="goalName" placeholder="Viagem, Reserva de Emergência...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor da Meta (R$)</label>
                        <input type="number" class="form-input" id="goalTarget" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor Atual (R$)</label>
                        <input type="number" class="form-input" id="goalCurrent" placeholder="0,00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prazo (meses)</label>
                        <input type="number" class="form-input" id="goalDeadline" placeholder="12" min="1">
                    </div>
                    <button class="btn btn-success" onclick="addGoal()" style="margin-top: 15px;">
                        <i class="fas fa-plus"></i> Adicionar Meta
                    </button>
                </div>
            </div>
        </div>

        <!-- Aba de Insights IA -->
        <div id="insights" class="tab-content">
            <div class="ai-insight">
                <div class="insight-header">
                    <div class="insight-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h3>Análise Inteligente</h3>
                </div>
                <p id="aiAnalysis">Adicione seus gastos para receber insights personalizados...</p>
            </div>

            <div class="ai-insight">
                <div class="insight-header">
                    <div class="insight-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h3>Oportunidades de Economia</h3>
                </div>
                <ul id="savingsTips">
                    <li>Comece adicionando seus gastos para ver dicas personalizadas</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Usuários
        let users = JSON.parse(localStorage.getItem('nexusFinanceUsers')) || [];
        let currentUser = JSON.parse(localStorage.getItem('nexusFinanceCurrentUser')) || null;

        // Sistema de Dados (por usuário)
        let expenses = [];
        let revenues = [];
        let goals = [];
        let monthlyBudget = 5000;
        let expenseChartInstance = null;
        let incomeChartInstance = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Registrar o plugin de datalabels globalmente
        Chart.register(ChartDataLabels);

        // Inicialização
        function initApp() {
            if (currentUser) {
                loadUserData();
                showDashboard();
            } else {
                showLogin();
            }
        }

        // Sistema de Autenticação
        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.login-tab[onclick="switchLoginTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        }

        function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!name || !email || !password) {
                showNotification('Preencha todos os campos!', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('A senha deve ter pelo menos 6 caracteres!', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('As senhas não coincidem!', 'error');
                return;
            }

            if (users.find(user => user.email === email)) {
                showNotification('Este email já está cadastrado!', 'error');
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                email,
                password, // Em produção, isso deve ser criptografado
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('nexusFinanceUsers', JSON.stringify(users));
            
            showNotification('Conta criada com sucesso! Faça login para continuar.', 'success');
            switchLoginTab('login');
            
            // Limpar formulário
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerConfirmPassword').value = '';
        }

        function login() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('nexusFinanceCurrentUser', JSON.stringify(currentUser));
                loadUserData();
                showDashboard();
                showNotification(`Bem-vindo de volta, ${user.name}!`, 'success');
            } else {
                showNotification('Email ou senha incorretos!', 'error');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('nexusFinanceCurrentUser');
            showLogin();
            showNotification('Logout realizado com sucesso!', 'info');
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboardScreen').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').style.display = 'block';
            
            // Atualizar informações do usuário
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            
            // Criar avatar com iniciais
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userAvatar').innerHTML = initials.substring(0, 2);
            
            // Inicializar dashboard
            initMonthTabs();
            updateDashboard();
            renderAchievements();
            renderGoals();
            updateInsights();
        }

        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem(`nexusFinanceData_${currentUser.id}`)) || {
                expenses: [],
                revenues: [],
                goals: []
            };
            
            expenses = userData.expenses || [];
            revenues = userData.revenues || [];
            goals = userData.goals || [];
        }

        function saveUserData() {
            const userData = {
                expenses,
                revenues,
                goals
            };
            localStorage.setItem(`nexusFinanceData_${currentUser.id}`, JSON.stringify(userData));
        }

        // Sistema de Meses
        function initMonthTabs() {
            const monthTabs = document.getElementById('monthTabs');
            const months = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];

            monthTabs.innerHTML = months.map((month, index) => `
                <div class="month-tab ${index === currentMonth ? 'active' : ''}" 
                     onclick="switchMonth(${index})">
                    ${month}
                </div>
            `).join('');

            updateMonthDisplay();
        }

        function switchMonth(monthIndex) {
            currentMonth = monthIndex;
            document.querySelectorAll('.month-tab').forEach((tab, index) => {
                tab.classList.toggle('active', index === monthIndex);
            });
            updateMonthDisplay();
            updateDashboard();
        }

        function updateMonthDisplay() {
            const months = [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            document.getElementById('currentMonthDisplay').textContent = 
                `${months[currentMonth]} ${currentYear}`;
        }

        // Adicionar Receita
        function addRevenue() {
            const name = document.getElementById('revenueName').value.trim();
            const value = parseFloat(document.getElementById('revenueValue').value);

            if (!name || isNaN(value) || value <= 0) {
                showNotification('Preencha todos os campos corretamente!', 'error');
                return;
            }

            const revenue = {
                id: Date.now(),
                name,
                value,
                month: currentMonth,
                year: currentYear,
                date: new Date().toISOString()
            };

            revenues.push(revenue);
            saveUserData();
            updateDashboard();
            
            document.getElementById('revenueName').value = '';
            document.getElementById('revenueValue').value = '';

            showNotification('Receita adicionada com sucesso!', 'success');
        }

        // Adicionar Gasto
        function addExpense() {
            const name = document.getElementById('expenseName').value.trim();
            const value = parseFloat(document.getElementById('expenseValue').value);
            const category = document.getElementById('expenseCategory').value;

            if (!name || isNaN(value) || value <= 0) {
                showNotification('Preencha todos os campos corretamente!', 'error');
                return;
            }

            const expense = {
                id: Date.now(),
                name,
                value,
                category,
                month: currentMonth,
                year: currentYear,
                date: new Date().toISOString(),
                type: category === 'essential' ? 'Essencial' : 'Não Essencial'
            };

            expenses.push(expense);
            saveUserData();
            updateDashboard();

            document.getElementById('expenseName').value = '';
            document.getElementById('expenseValue').value = '';

            showNotification('Gasto adicionado com sucesso!', 'success');
        }

        // Adicionar Meta
        function addGoal() {
            const name = document.getElementById('goalName').value.trim();
            const target = parseFloat(document.getElementById('goalTarget').value);
            const current = parseFloat(document.getElementById('goalCurrent').value);
            const deadline = parseInt(document.getElementById('goalDeadline').value);

            if (!name || isNaN(target) || target <= 0 || isNaN(current) || current < 0 || isNaN(deadline) || deadline <= 0) {
                showNotification('Preencha todos os campos corretamente!', 'error');
                return;
            }

            const goal = {
                id: Date.now(),
                name,
                target,
                current,
                deadline,
                createdAt: new Date().toISOString()
            };

            goals.push(goal);
            saveUserData();
            renderAchievements();
            renderGoals();
            closeAddGoalModal();

            showNotification('Meta adicionada com sucesso!', 'success');
        }

        // Remover Meta
        function removeGoal(id) {
            goals = goals.filter(goal => goal.id !== id);
            saveUserData();
            renderAchievements();
            renderGoals();
            showNotification('Meta removida!', 'warning');
        }

        // Atualizar Dashboard
        function updateDashboard() {
            const monthExpenses = expenses.filter(exp => 
                exp.month === currentMonth && exp.year === currentYear
            );
            const monthRevenues = revenues.filter(rev => 
                rev.month === currentMonth && rev.year === currentYear
            );

            const essentialTotal = monthExpenses
                .filter(exp => exp.category === 'essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const nonEssentialTotal = monthExpenses
                .filter(exp => exp.category === 'non-essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const revenueTotal = monthRevenues
                .reduce((sum, rev) => sum + rev.value, 0);

            const totalExpenses = essentialTotal + nonEssentialTotal;

            // Atualizar cards
            document.getElementById('essentialAmount').textContent = 
                `R$ ${essentialTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('nonEssentialAmount').textContent = 
                `R$ ${nonEssentialTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('revenueAmount').textContent = 
                `R$ ${revenueTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            // Atualizar progresso
            const essentialPercent = revenueTotal > 0 ? Math.min((essentialTotal / revenueTotal) * 100, 100) : 0;
            const nonEssentialPercent = revenueTotal > 0 ? Math.min((nonEssentialTotal / revenueTotal) * 100, 100) : 0;
            const revenueUsagePercent = revenueTotal > 0 ? Math.min((totalExpenses / revenueTotal) * 100, 100) : 0;

            document.getElementById('essentialProgress').style.width = `${essentialPercent}%`;
            document.getElementById('nonEssentialProgress').style.width = `${nonEssentialPercent}%`;
            document.getElementById('revenueProgress').style.width = `${revenueUsagePercent}%`;

            document.getElementById('essentialMeta').textContent = 
                `${essentialPercent.toFixed(1)}% da receita`;
            document.getElementById('nonEssentialMeta').textContent = 
                `${nonEssentialPercent.toFixed(1)}% da receita`;
            document.getElementById('revenueMeta').textContent = 
                `${revenueUsagePercent.toFixed(1)}% utilizado`;

            // Atualizar listas detalhadas
            updateExpenseLists(monthExpenses);
        }

        // Atualizar Listas de Gastos
        function updateExpenseLists(monthExpenses) {
            const essentialExpenses = monthExpenses.filter(exp => exp.category === 'essential');
            const nonEssentialExpenses = monthExpenses.filter(exp => exp.category === 'non-essential');

            // Lista de Essenciais
            const essentialList = document.getElementById('essentialList');
            if (essentialExpenses.length === 0) {
                essentialList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">Nenhum gasto essencial este mês</div>';
            } else {
                essentialList.innerHTML = essentialExpenses.map(expense => `
                    <div class="category-item">
                        <div class="category-item-name">
                            <div class="category-item-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <span>${expense.name}</span>
                        </div>
                        <div class="expense-amount">
                            R$ ${expense.value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                    </div>
                `).join('');
            }

            // Lista de Não Essenciais
            const nonEssentialList = document.getElementById('nonEssentialList');
            if (nonEssentialExpenses.length === 0) {
                nonEssentialList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">Nenhum gasto não essencial este mês</div>';
            } else {
                nonEssentialList.innerHTML = nonEssentialExpenses.map(expense => `
                    <div class="category-item">
                        <div class="category-item-name">
                            <div class="category-item-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <span>${expense.name}</span>
                        </div>
                        <div class="expense-amount">
                            R$ ${expense.value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                    </div>
                `).join('');
            }
        }

        // Atualizar Gráficos
        function updateCharts() {
            const monthExpenses = expenses.filter(exp => 
                exp.month === currentMonth && exp.year === currentYear
            );
            const monthRevenues = revenues.filter(rev => 
                rev.month === currentMonth && rev.year === currentYear
            );

            const essentialTotal = monthExpenses
                .filter(exp => exp.category === 'essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const nonEssentialTotal = monthExpenses
                .filter(exp => exp.category === 'non-essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const revenueTotal = monthRevenues
                .reduce((sum, rev) => sum + rev.value, 0);

            const savings = Math.max(0, revenueTotal - essentialTotal - nonEssentialTotal);
            const total = essentialTotal + nonEssentialTotal + savings;
            
            // Destruir gráficos existentes
            if (expenseChartInstance) {
                expenseChartInstance.destroy();
            }
            if (incomeChartInstance) {
                incomeChartInstance.destroy();
            }

            // Gráfico de Distribuição de Gastos
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            expenseChartInstance = new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Essenciais', 'Não Essenciais', 'Economia'],
                    datasets: [{
                        data: [essentialTotal, nonEssentialTotal, savings],
                        backgroundColor: ['#0066FF', '#FF6B35', '#00D4AA'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#F8FAFC',
                                padding: 20,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0';
                                    return `${label}: R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#FFFFFF',
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: (value, context) => {
                                if (value > 0) {
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0';
                                    return `R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 0 })}\n${percentage}%`;
                                }
                                return '';
                            },
                            textShadow: '0px 1px 2px rgba(0, 0, 0, 0.8)',
                            textAlign: 'center'
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Gráfico de Evolução de Renda
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const monthlyRevenues = months.map((month, index) => {
                const monthRevs = revenues.filter(rev => 
                    rev.month === index && rev.year === currentYear
                );
                return monthRevs.reduce((sum, rev) => sum + rev.value, 0);
            });

            incomeChartInstance = new Chart(incomeCtx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Receita Mensal',
                        data: monthlyRevenues,
                        borderColor: '#00D4AA',
                        backgroundColor: 'rgba(0, 212, 170, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        pointBackgroundColor: '#00D4AA',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#F8FAFC',
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Receita: R$ ${context.raw.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#FFFFFF',
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: (value) => {
                                if (value > 0) {
                                    return `R$ ${value.toLocaleString('pt-BR', { minimumFractionDigits: 0 })}`;
                                }
                                return '';
                            },
                            align: 'top',
                            offset: 8,
                            textShadow: '0px 1px 2px rgba(0, 0, 0, 0.8)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#F8FAFC',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#F8FAFC' }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Sistema de Conquistas - VERSÃO COLORIDA
        function renderAchievements() {
            const achievementsGrid = document.getElementById('achievementsGrid');
            
            const totalGoals = goals.length;
            const completedGoals = goals.filter(goal => goal.current >= goal.target).length;
            const inProgressGoals = totalGoals - completedGoals;
            const completionRate = totalGoals > 0 ? (completedGoals / totalGoals * 100).toFixed(0) : 0;

            achievementsGrid.innerHTML = `
                <div class="achievement-card">
                    <div class="achievement-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="achievement-value">${totalGoals}</div>
                    <div class="achievement-label">Total de Metas</div>
                    <div class="achievement-description">Metas criadas até agora</div>
                </div>

                <div class="achievement-card success">
                    <div class="achievement-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="achievement-value">${completedGoals}</div>
                    <div class="achievement-label">Metas Concluídas</div>
                    <div class="achievement-description">Objetivos alcançados</div>
                </div>

                <div class="achievement-card">
                    <div class="achievement-icon">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="achievement-value">${inProgressGoals}</div>
                    <div class="achievement-label">Em Andamento</div>
                    <div class="achievement-description">Metas sendo trabalhadas</div>
                </div>

                <div class="achievement-card success">
                    <div class="achievement-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="achievement-value">${completionRate}%</div>
                    <div class="achievement-label">Taxa de Sucesso</div>
                    <div class="achievement-description">Eficiência nas metas</div>
                </div>
            `;
        }

        // Sistema de Metas - VERSÃO COLORIDA
        function renderGoals() {
            const goalsList = document.getElementById('goalsList');
            
            if (goals.length === 0) {
                goalsList.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: var(--gray);">
                        <i class="fas fa-bullseye" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>Nenhuma meta cadastrada</h3>
                        <p>Comece criando suas metas financeiras</p>
                    </div>
                `;
                return;
            }

            goalsList.innerHTML = goals.map(goal => {
                const progress = (goal.current / goal.target) * 100;
                const remaining = goal.target - goal.current;
                const monthlySave = remaining / goal.deadline;
                const isCompleted = goal.current >= goal.target;

                return `
                    <div class="goal-card ${isCompleted ? 'success' : ''}">
                        <div class="goal-header">
                            <div class="goal-title">
                                ${goal.name}
                                ${isCompleted ? '<span style="color: var(--success); margin-left: 10px;"><i class="fas fa-check-circle"></i> Concluída</span>' : ''}
                            </div>
                            <div class="goal-amount">
                                R$ ${goal.current.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}<br>
                                <small style="font-size: 0.9rem; color: var(--gray);">de R$ ${goal.target.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</small>
                            </div>
                        </div>
                        
                        <div class="goal-progress-container">
                            <div class="goal-progress-info">
                                <span>Progresso</span>
                                <span>${progress.toFixed(1)}%</span>
                            </div>
                            <div class="goal-progress">
                                <div class="goal-progress-bar" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>
                        
                        ${!isCompleted ? `
                        <div class="goal-details">
                            <div class="goal-detail-item">
                                <div class="goal-detail-label">Falta Economizar</div>
                                <div class="goal-detail-value remaining">R$ ${remaining.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                            </div>
                            <div class="goal-detail-item">
                                <div class="goal-detail-label">Economia Mensal</div>
                                <div class="goal-detail-value monthly">R$ ${monthlySave.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="goal-actions">
                            <button class="btn-outline" onclick="removeGoal(${goal.id})">
                                <i class="fas fa-trash"></i>
                                Remover Meta
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Modal Functions
        function showAddGoalModal() {
            document.getElementById('addGoalModal').classList.add('active');
            document.getElementById('goalName').value = '';
            document.getElementById('goalTarget').value = '';
            document.getElementById('goalCurrent').value = '';
            document.getElementById('goalDeadline').value = '12';
        }

        function closeAddGoalModal() {
            document.getElementById('addGoalModal').classList.remove('active');
        }

        // Sistema de Abas Principal
        function switchMainTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'insights') {
                updateInsights();
            } else if (tabName === 'reports') {
                updateCharts();
            }
        }

        // Atualizar Insights da IA
        function updateInsights() {
            const monthExpenses = expenses.filter(exp => 
                exp.month === currentMonth && exp.year === currentYear
            );
            const monthRevenues = revenues.filter(rev => 
                rev.month === currentMonth && rev.year === currentYear
            );

            const essentialTotal = monthExpenses
                .filter(exp => exp.category === 'essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const nonEssentialTotal = monthExpenses
                .filter(exp => exp.category === 'non-essential')
                .reduce((sum, exp) => sum + exp.value, 0);

            const revenueTotal = monthRevenues
                .reduce((sum, rev) => sum + rev.value, 0);

            const total = essentialTotal + nonEssentialTotal;
            const savings = revenueTotal - total;

            if (total === 0) {
                document.getElementById('aiAnalysis').textContent = 
                    'Adicione seus gastos para receber uma análise inteligente do seu comportamento financeiro.';
                return;
            }

            const essentialPercent = ((essentialTotal / total) * 100).toFixed(1);
            const nonEssentialPercent = ((nonEssentialTotal / total) * 100).toFixed(1);
            const savingsRate = ((savings / revenueTotal) * 100).toFixed(1);

            let analysis = `Você gasta ${essentialPercent}% em necessidades essenciais e ${nonEssentialPercent}% em gastos variáveis. `;
            
            if (savings > 0) {
                analysis += `Sua taxa de economia está em ${savingsRate}% (R$ ${savings.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}). `;
            } else {
                analysis += `⚠️ Atenção: Você está gastando mais do que ganha este mês. `;
            }

            // Análise comparativa com o mês anterior
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            const prevMonthExpenses = expenses.filter(exp => 
                exp.month === prevMonth && exp.year === prevYear
            ).reduce((sum, exp) => sum + exp.value, 0);

            if (prevMonthExpenses > 0) {
                const change = ((total - prevMonthExpenses) / prevMonthExpenses * 100).toFixed(1);
                if (Math.abs(change) > 5) {
                    analysis += `Seus gastos ${change > 0 ? 'aumentaram' : 'diminuíram'} ${Math.abs(change)}% em relação ao mês anterior.`;
                }
            }

            document.getElementById('aiAnalysis').textContent = analysis;

            // Dicas de economia melhoradas
            const tips = [];
            
            if (nonEssentialPercent > 30) {
                tips.push('💡 Considere reduzir gastos não essenciais em 15% para aumentar sua economia mensal');
            }
            
            if (essentialPercent > 60) {
                tips.push('🏠 Avalie se todos os gastos essenciais são realmente necessários este mês');
            }
            
            if (total < revenueTotal * 0.7) {
                tips.push('✅ Excelente! Você está economizando mais de 30% da sua renda');
            }
            
            if (savings < 0) {
                tips.push('🚨 Atenção: Você está gastando mais do que ganha. Considere revisar seus gastos essenciais');
            }

            const tipsList = document.getElementById('savingsTips');
            tipsList.innerHTML = tips.length > 0 
                ? tips.map(tip => `<li>${tip}</li>`).join('')
                : '<li>Seus gastos estão dentro de uma proporção saudável. Continue assim!</li>';
        }

        // Sistema de Notificações
        function showNotification(message, type = 'info') {
            let notificationContainer = document.querySelector('.notification-container');
            if (!notificationContainer) {
                notificationContainer = document.createElement('div');
                notificationContainer.className = 'notification-container';
                document.body.appendChild(notificationContainer);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                </div>
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Auto-remover após 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function getNotificationIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // Fechar modal ao clicar fora
        document.getElementById('addGoalModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddGoalModal();
            }
        });

        // Inicializar app quando a página carregar
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>